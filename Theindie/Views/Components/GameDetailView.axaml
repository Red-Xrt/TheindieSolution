<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="using:Theindie.Models"
             x:DataType="models:GameInfo"
             x:Class="Theindie.Views.Components.GameDetailView">

    <UserControl.Styles>
        <Style Selector="StackPanel.AnimEntry">
            <Style.Animations>
                <Animation Duration="0:0:0.6" Easing="CubicEaseOut" FillMode="Forward">
                    <KeyFrame KeyTime="0:0:0"><Setter Property="Opacity" Value="0"/><Setter Property="TranslateTransform.Y" Value="50"/></KeyFrame>
                    <KeyFrame KeyTime="0:0:0.6"><Setter Property="Opacity" Value="1"/><Setter Property="TranslateTransform.Y" Value="0"/></KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="Grid#UninstallConfirmOverlay[IsVisible=True] Border.DialogBox">
            <Style.Animations>
                <Animation Duration="0:0:0.25" Easing="BackEaseOut" FillMode="Forward">
                    <KeyFrame KeyTime="0:0:0"><Setter Property="Opacity" Value="0"/><Setter Property="ScaleTransform.ScaleX" Value="0.9"/><Setter Property="ScaleTransform.ScaleY" Value="0.9"/></KeyFrame>
                    <KeyFrame KeyTime="0:0:0.25"><Setter Property="Opacity" Value="1"/><Setter Property="ScaleTransform.ScaleX" Value="1"/><Setter Property="ScaleTransform.ScaleY" Value="1"/></KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
    </UserControl.Styles>

    <Grid Background="{StaticResource DeepBackground}">
        
        <Panel>
            <Image Source="{Binding ImagePath, Converter={StaticResource BitmapConverter}}" Stretch="UniformToFill" Opacity="0.4">
                <Image.Effect><BlurEffect Radius="80"/></Image.Effect>
            </Image>
            <Border><Border.Background><LinearGradientBrush StartPoint="0,0" EndPoint="0,1"><GradientStop Offset="0" Color="#90050505"/><GradientStop Offset="1" Color="#050505"/></LinearGradientBrush></Border.Background></Border>
        </Panel>

        <Grid RowDefinitions="80, *" Margin="40,0">
            <Border Grid.Row="0" Background="Transparent" PointerPressed="OnRootPointerPressed"/>

            <Grid Grid.Row="0" VerticalAlignment="Center">
                <Button Classes="GhostBtn" Click="BackButton_Click" Foreground="White" Opacity="0.7">
                    <Button.Styles>
                        <Style Selector="Button:pointerover"><Setter Property="Opacity" Value="1"/></Style>
                    </Button.Styles>
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="←" FontWeight="Bold" FontSize="16" VerticalAlignment="Center"/>
                        <TextBlock Text="QUAY LẠI THƯ VIỆN" FontWeight="Bold" FontSize="12" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </Grid>

            <Grid Grid.Row="1" ColumnDefinitions="*, 360" Margin="0,0,0,40">
                <ScrollViewer Grid.Column="0" Padding="0,0,50,0" VerticalScrollBarVisibility="Hidden">
                    <StackPanel Classes="AnimEntry" Spacing="30">
                        <StackPanel Spacing="10">
                            <TextBlock Text="{Binding Title}" FontWeight="Black" FontSize="64" Foreground="White" LineHeight="64" TextWrapping="Wrap"/>
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <Border Background="{StaticResource PrimaryRed}" CornerRadius="8" Padding="8,4"><TextBlock Text="VIỆT HÓA" FontSize="11" FontWeight="Bold" Foreground="White"/></Border>
                                <Border Background="#20FFFFFF" CornerRadius="4" Padding="10,4"><TextBlock Text="{Binding Tags}" FontSize="12" Foreground="#DDD"/></Border>
                                <Border Background="#20FFFFFF" CornerRadius="4" Padding="10,4"><TextBlock Text="⭐ 4.9/5" FontSize="12" Foreground="#FFD700" FontWeight="Bold"/></Border>
                            </StackPanel>
                        </StackPanel>

                        <Border Height="400" CornerRadius="12" Background="Black" BorderBrush="#30FFFFFF" BorderThickness="1" ClipToBounds="True">
                            <Panel>
                                <Image Source="{Binding ImagePath, Converter={StaticResource BitmapConverter}}" Stretch="UniformToFill" Opacity="0.5"/>
                                <Border Width="70" Height="70" CornerRadius="35" Background="#80000000" BorderBrush="White" BorderThickness="2">
                                    <TextBlock Text="▶" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="28" Margin="5,0,0,0"/>
                                </Border>
                            </Panel>
                        </Border>

                        <StackPanel Spacing="10">
                            <TextBlock Text="GIỚI THIỆU" FontWeight="Bold" FontSize="18" Foreground="White"/>
                            <TextBlock Text="{Binding Description}" Foreground="#BBB" FontSize="15" LineHeight="26" TextWrapping="Wrap"/>
                        </StackPanel>
                        <Panel Height="50"/> 
                    </StackPanel>
                </ScrollViewer>

                <Border Grid.Column="1" Background="#141414" CornerRadius="16" BorderBrush="{StaticResource GlassBorder}" BorderThickness="1" Padding="25" VerticalAlignment="Top">
                    <StackPanel Spacing="25">
                        <Border CornerRadius="8" ClipToBounds="True" Height="240" BoxShadow="0 10 30 0 #50000000">
                            <Image Source="{Binding ImagePath, Converter={StaticResource BitmapConverter}}" Stretch="UniformToFill"/>
                        </Border>

                        <StackPanel Spacing="15">
                            <TextBlock Text="THÔNG TIN" FontWeight="Bold" Foreground="#666" FontSize="11" LetterSpacing="1"/>
                            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto, *" ShowGridLines="False">
                                <TextBlock Grid.Row="0" Grid.Column="0" Foreground="#888" Text="Phiên bản" Margin="0,0,0,12"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Foreground="White" FontWeight="Bold" HorizontalAlignment="Right" Text="{Binding Version}" Margin="0,0,0,12"/>
                                <TextBlock Grid.Row="1" Grid.Column="0" Foreground="#888" Text="Dung lượng" Margin="0,0,0,12"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Foreground="White" FontWeight="Bold" HorizontalAlignment="Right" Text="{Binding Size}" Margin="0,0,0,12"/>
                                <TextBlock Grid.Row="2" Grid.Column="0" Foreground="#888" Text="Cập nhật"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Foreground="White" FontWeight="Bold" HorizontalAlignment="Right" Text="{Binding UpdateDate}"/>
                            </Grid>
                        </StackPanel>
                        <Separator Background="#20FFFFFF" Height="1"/>

                        <Panel>
                            <Button IsVisible="{Binding !IsInstalled}"
                                    Classes="Primary" Height="54" HorizontalAlignment="Stretch" 
                                    Click="InstallButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock Text="⬇" FontSize="20" FontWeight="Black" VerticalAlignment="Center"/>
                                    <TextBlock Text="CÀI ĐẶT VIỆT HÓA" FontSize="15" FontWeight="Bold" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button IsVisible="{Binding IsInstalled}"
                                    Background="#25FFFFFF" BorderBrush="#E81123" BorderThickness="1"
                                    CornerRadius="6" Height="54" HorizontalAlignment="Stretch" 
                                    Click="UninstallButton_Click">
                                <Button.Styles>
                                    <Style Selector="Button:pointerover /template/ ContentPresenter">
                                        <Setter Property="Background" Value="#20E81123"/>
                                        <Setter Property="BorderBrush" Value="#FF1F2F"/>
                                    </Style>
                                </Button.Styles>
                                <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock Text="🗑" FontSize="18" Foreground="#E81123" VerticalAlignment="Center"/>
                                    <TextBlock Text="GỠ VIỆT HÓA" FontSize="15" FontWeight="Bold" Foreground="#E81123" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Panel>
                        
                        <TextBlock Text="An toàn &amp; Miễn phí" HorizontalAlignment="Center" FontSize="11" Foreground="#555" FontStyle="Italic"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <Grid Name="UninstallConfirmOverlay" IsVisible="False" Background="#CC000000">
            <Border Classes="DialogBox" Width="420" VerticalAlignment="Center" HorizontalAlignment="Center" 
                    CornerRadius="16" BorderThickness="1" BorderBrush="#30FFFFFF" Background="#1A1A1A"
                    BoxShadow="0 20 60 0 #80000000">
                <Border Padding="30">
                    <StackPanel Spacing="25">
                        <StackPanel Spacing="15">
                            <TextBlock Text="⚠️ XÁC NHẬN GỠ" FontWeight="Black" FontSize="20" Foreground="#E81123" HorizontalAlignment="Center"/>
                            <TextBlock TextAlignment="Center" Foreground="#AAA" TextWrapping="Wrap" FontSize="14" LineHeight="22">
                                Bạn có chắc muốn xóa bản Việt Hóa của <Run Text="{Binding Title}" Foreground="White" FontWeight="Bold"/> không?
                            </TextBlock>
                        </StackPanel>
                        <Grid ColumnDefinitions="*, 15, *">
                            <Button Grid.Column="0" Content="HỦY BỎ" Click="CancelUninstall_Click" 
                                    Background="Transparent" BorderThickness="1" BorderBrush="#444" CornerRadius="6" Foreground="#CCC" Height="40"/>
                            <Button Grid.Column="2" Click="ConfirmUninstall_Click" 
                                    Background="#E81123" CornerRadius="6" Foreground="White" FontWeight="Bold" Height="40">
                                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock Text="✓" VerticalAlignment="Center"/>
                                    <TextBlock Text="ĐỒNG Ý" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>
                </Border>
            </Border>
        </Grid>
    </Grid>
</UserControl>
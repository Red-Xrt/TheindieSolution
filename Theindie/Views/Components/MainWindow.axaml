<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:components="using:Theindie.Views.Components"
        xmlns:models="using:Theindie.Models"
        xmlns:views="using:Theindie.Views"
        xmlns:vm="using:Theindie.ViewModels"
        x:Class="Theindie.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="The Indie Launcher" Icon="/Assets/Icons/Logo.ico"
        Background="Transparent" TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True" ExtendClientAreaChromeHints="NoChrome"
        
        WindowStartupLocation="CenterScreen"
        CanResize="False">

    <Window.Resources>
        <DataTemplate x:Key="GameListTemplate" x:DataType="vm:MainWindowViewModel">
            <StackPanel Spacing="20">
                <Grid ColumnDefinitions="Auto, *">
                    <TextBlock Text="DANH SÁCH GAME" FontWeight="Black" FontSize="14" Foreground="#666" LetterSpacing="1" Margin="10,0,0,0"/>
                    <Separator Grid.Column="1" Margin="20,0,10,0" Background="#20FFFFFF"/>
                </Grid>
                
                <Panel MinHeight="200">
                    <ItemsControl ItemsSource="{Binding Games}" IsVisible="{Binding !IsEmptyList}">
                        <ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel Margin="-10"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:GameInfo">
                                <components:GameCardView Width="230" Height="340" Click="OnGameCardClick"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <StackPanel IsVisible="{Binding IsEmptyList}" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20" Margin="0,40,0,0">
                        <PathIcon Data="M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M16.5,16.25C16.5,14.75 13.5,14.75 13.5,16.25C13.5,14.75 16.5,14.75 16.5,16.25M7.5,16.25C7.5,14.75 10.5,14.75 10.5,16.25C10.5,14.75 7.5,14.75 7.5,16.25M12,12.25C14.25,12.25 16.5,10.75 16.5,8.25C16.5,5.75 14.25,4.25 12,4.25C9.75,4.25 7.5,5.75 7.5,8.25C7.5,10.75 9.75,12.25 12,12.25Z" 
                                  Width="60" Height="60" Foreground="#333"/>
                        
                        <TextBlock Text="{Binding EmptyMessage}" 
                                   Foreground="#666" FontSize="16" FontWeight="Bold" 
                                   TextAlignment="Center" TextWrapping="Wrap" MaxWidth="400"/>
                        
                        </StackPanel>
                </Panel>
            </StackPanel>
        </DataTemplate>
    </Window.Resources>

    <Panel PointerPressed="OnRootPointerPressed">
        <Border Background="{StaticResource DeepBackground}"/>
        <ExperimentalAcrylicBorder IsHitTestVisible="False">
             <ExperimentalAcrylicBorder.Material>
                 <ExperimentalAcrylicMaterial BackgroundSource="Digger" TintColor="Black" TintOpacity="0.9" MaterialOpacity="0.2"/>
             </ExperimentalAcrylicBorder.Material>
        </ExperimentalAcrylicBorder>

        <SplitView DisplayMode="CompactInline"
                   IsPaneOpen="{Binding IsPaneOpen}"
                   CompactPaneLength="70"
                   OpenPaneLength="260"
                   PaneBackground="#05FFFFFF">

            <SplitView.Pane>
                <Border BorderBrush="{StaticResource GlassBorder}" BorderThickness="0,0,1,0" 
                        PointerEntered="OnSidebarPointerEntered" 
                        PointerExited="OnSidebarPointerExited"
                        Background="Transparent"
                        Padding="0,30"> 
                    
                    <Grid RowDefinitions="Auto, *, Auto" Background="Transparent">
                        
                        <StackPanel Grid.Row="0" Margin="13,0,0,50">
                            <StackPanel Orientation="Horizontal" Spacing="15">
                                <Border Width="44" Height="44" Background="{StaticResource RedGradient}" CornerRadius="10" BoxShadow="0 0 25 0 #50FF1F2F" BorderBrush="#FF5F6F" BorderThickness="1">
                                    <TextBlock Text="TI" Foreground="White" FontWeight="Black" FontSize="18" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center" IsVisible="{Binding IsPaneOpen}">
                                    <TextBlock Text="THE INDIE" FontWeight="Black" FontSize="18" Foreground="White" LetterSpacing="0.5"/>
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <TextBlock Text="LAUNCHER" FontSize="10" Foreground="#666" FontWeight="Bold" LetterSpacing="2"/>
                                        <Border Background="{StaticResource PrimaryRed}" CornerRadius="2" Padding="4,1"><TextBlock Text="PRO" FontSize="8" FontWeight="Black" Foreground="White"/></Border>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Spacing="2" Background="Transparent">
                            
                            <TextBlock Text="MAIN MENU" IsVisible="{Binding IsPaneOpen}" FontSize="11" Foreground="#444" FontWeight="Bold" Margin="20,0,0,10" LetterSpacing="1"/>
                            
                            <Button Classes="SidebarItem" Command="{Binding SwitchPageCommand}" CommandParameter="0" 
                                    Classes.Active="{Binding CurrentPage, Converter={StaticResource PageActiveConverter}, ConverterParameter=0}"
                                    ToolTip.Tip="Trang Chủ">
                                <StackPanel Orientation="Horizontal">
                                    <Grid Width="70" Height="24"><PathIcon Data="{StaticResource IconHome}" HorizontalAlignment="Center"/></Grid>
                                    <TextBlock Text="Trang Chủ" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="SidebarItem" Command="{Binding SwitchPageCommand}" CommandParameter="1" 
                                    Classes.Active="{Binding CurrentPage, Converter={StaticResource PageActiveConverter}, ConverterParameter=1}"
                                    ToolTip.Tip="Đã Cài Đặt">
                                <StackPanel Orientation="Horizontal">
                                    <Grid Width="70" Height="24"><PathIcon Data="{StaticResource IconCheck}" HorizontalAlignment="Center"/></Grid>
                                    <TextBlock Text="Đã Cài Đặt" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Separator Background="#10FFFFFF" Margin="20,20"/>

                            <TextBlock Text="SYSTEM" IsVisible="{Binding IsPaneOpen}" FontSize="11" Foreground="#444" FontWeight="Bold" Margin="20,0,0,10" LetterSpacing="1"/>
                            
                            <Button Classes="SidebarItem" Command="{Binding SwitchPageCommand}" CommandParameter="2" 
                                    Classes.Active="{Binding CurrentPage, Converter={StaticResource PageActiveConverter}, ConverterParameter=2}"
                                    ToolTip.Tip="Tải Xuống">
                                <StackPanel Orientation="Horizontal">
                                    <Grid Width="70" Height="24"><PathIcon Data="{StaticResource IconDownload}" HorizontalAlignment="Center"/></Grid>
                                    <TextBlock Text="Tải Xuống" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="SidebarItem" Command="{Binding SwitchPageCommand}" CommandParameter="3" 
                                    Classes.Active="{Binding CurrentPage, Converter={StaticResource PageActiveConverter}, ConverterParameter=3}"
                                    ToolTip.Tip="Cấu Hình">
                                <StackPanel Orientation="Horizontal">
                                    <Grid Width="70" Height="24"><PathIcon Data="{StaticResource IconSettings}" HorizontalAlignment="Center"/></Grid>
                                    <TextBlock Text="Cấu Hình" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <Border Grid.Row="2" Margin="10,0" Background="#08FFFFFF" CornerRadius="12" Padding="5" BorderBrush="{StaticResource GlassBorder}" BorderThickness="1">
                            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center" HorizontalAlignment="Left">
                                <Border Width="36" Height="36" Margin="2,0,0,0" CornerRadius="18" Background="#20FFFFFF" ClipToBounds="True">
                                    <PathIcon Data="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" Foreground="#AAA" Width="20" Height="20"/>
                                </Border>
                                
                                <StackPanel VerticalAlignment="Center" IsVisible="{Binding IsPaneOpen}">
                                    <TextBlock Text="Admin" FontWeight="Bold" Foreground="White" FontSize="13"/>
                                    <TextBlock Text="Online" FontSize="10" Foreground="#4ade80"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </SplitView.Pane>

            <SplitView.Content>
                <Grid RowDefinitions="70, *">
                    <Grid Grid.Row="0" Background="Transparent" PointerPressed="OnHeaderPointerPressed">
                        <Grid ColumnDefinitions="*, 250, 140" Margin="40,0">
                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <TextBlock Text="{Binding PageTitle}" FontWeight="Black" FontSize="24" Foreground="White" LetterSpacing="-0.5"/>
                            </StackPanel>
                            <TextBox Grid.Column="1" Text="{Binding SearchText}" Classes="SearchInput" Watermark="Tìm kiếm game..." VerticalAlignment="Center">
                                <TextBox.InnerRightContent>
                                    <PathIcon Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" Width="16" Height="16" Foreground="#666" Margin="0,0,10,0"/>
                                </TextBox.InnerRightContent>
                            </TextBox>
                        </Grid>
                    </Grid>

                    <Carousel Grid.Row="1" SelectedIndex="{Binding CurrentPage}">
                        <ScrollViewer Padding="30,0,30,40">
                            <StackPanel Spacing="35">
                                <Border Height="260" MaxWidth="1100" HorizontalAlignment="Center" Margin="10,0,10,0" CornerRadius="16" ClipToBounds="True" BoxShadow="0 20 60 0 #60000000" BorderBrush="{StaticResource PrimaryRed}" BorderThickness="0,0,0,2">
                                    <Panel>
                                        <Image Source="/Assets/Icons/Logo.ico" Stretch="UniformToFill" Opacity="0.7"/>
                                        <Border Background="{StaticResource BgDark}" Opacity="0.3"/>
                                        <Border><Border.Background><LinearGradientBrush StartPoint="0,0" EndPoint="0,1"><GradientStop Offset="0.4" Color="Transparent"/><GradientStop Offset="1" Color="#050505"/></LinearGradientBrush></Border.Background></Border>
                                        <Grid RowDefinitions="*, Auto" Margin="30">
                                            <StackPanel Grid.Row="1">
                                                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
                                                    <Border Background="{StaticResource PrimaryRed}" CornerRadius="4" Padding="8,4"><TextBlock Text="HOT" Foreground="White" FontWeight="Black" FontSize="11"/></Border>
                                                    <Border Background="#30FFFFFF" CornerRadius="4" Padding="8,4"><TextBlock Text="BẢN CẬP NHẬT MỚI" Foreground="White" FontWeight="Bold" FontSize="11"/></Border>
                                                </StackPanel>
                                                <TextBlock Text="STARDEW VALLEY" FontWeight="Black" FontSize="42" Foreground="White" LineHeight="45" TextWrapping="Wrap"/>
                                                <TextBlock Text="Đã cập nhật bản Việt Hóa v1.5.6 đầy đủ DLC." Foreground="#CCC" FontSize="15" Margin="0,8,0,20" TextWrapping="Wrap"/>
                                                <Button Classes="Primary" HorizontalAlignment="Left">
                                                    <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                                        <PathIcon Data="{StaticResource IconPlay}" Width="14"/>
                                                        <TextBlock Text="XEM CHI TIẾT" FontWeight="Bold" FontSize="13"/>
                                                    </StackPanel>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Panel>
                                </Border>
                                <ContentControl Content="{Binding}" ContentTemplate="{StaticResource GameListTemplate}"/>
                                <Panel Height="50"/>
                            </StackPanel>
                        </ScrollViewer>

                        <ScrollViewer Padding="30,0,30,40">
                            <StackPanel Spacing="30">
                                <Border Height="10"/>
                                <ContentControl Content="{Binding}" ContentTemplate="{StaticResource GameListTemplate}"/>
                                <Panel Height="50"/>
                            </StackPanel>
                        </ScrollViewer>

                        <Grid><TextBlock Text="DOWNLOADS" FontSize="40" Foreground="#222" FontWeight="Black" HorizontalAlignment="Center" VerticalAlignment="Center"/></Grid>
                        <Grid><TextBlock Text="SETTINGS" FontSize="40" Foreground="#222" FontWeight="Black" HorizontalAlignment="Center" VerticalAlignment="Center"/></Grid>
                    </Carousel>
                </Grid>
            </SplitView.Content>
        </SplitView>

        <components:GameDetailView Name="DetailOverlay" IsVisible="False" BackRequested="HideDetail_Overlay" InstallRequested="ShowInstall_Wizard" UninstallRequested="OnUninstallRequested"/>
        <components:InstallationWizardView Name="InstallWizard" IsVisible="False" CloseRequested="HideInstall_Wizard"/>

<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0">
             <Button Classes="WindowControl" Content="─" Click="Minimize_Click"/>
             <Button Classes="WindowControl Close" Content="✕" Click="Close_Click"/>
        </StackPanel>

        <Border IsVisible="{Binding IsNotificationVisible}"
                HorizontalAlignment="Right" VerticalAlignment="Bottom"
                Margin="0,0,30,30" Padding="15,10" CornerRadius="8"
                Background="#20FFFFFF" BorderBrush="{StaticResource PrimaryRed}" BorderThickness="1"
                BoxShadow="0 4 20 0 #40000000">
            
            <Border.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.3"/>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.3" Easing="CubicEaseOut"/>
                </Transitions>
            </Border.Transitions>
            
            <Border.Styles>
                <Style Selector="Border[IsVisible=True]">
                    <Style.Animations>
                        <Animation Duration="0:0:0.3" Easing="CubicEaseOut" FillMode="Forward">
                            <KeyFrame KeyTime="0:0:0"><Setter Property="Opacity" Value="0"/><Setter Property="TranslateTransform.Y" Value="20"/></KeyFrame>
                            <KeyFrame KeyTime="0:0:0.3"><Setter Property="Opacity" Value="1"/><Setter Property="TranslateTransform.Y" Value="0"/></KeyFrame>
                        </Animation>
                    </Style.Animations>
                </Style>
            </Border.Styles>

            <StackPanel Orientation="Horizontal" Spacing="10">
                <PathIcon Data="{StaticResource IconCheck}" Foreground="#4ade80" Width="16" Height="16"/>
                <TextBlock Text="{Binding NotificationMessage}" Foreground="White" FontWeight="Bold" FontSize="14" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Panel>
</Window>
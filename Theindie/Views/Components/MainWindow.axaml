<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:components="using:Theindie.Views.Components"
        xmlns:models="using:Theindie.Models"
        xmlns:views="using:Theindie.Views"
        xmlns:vm="using:Theindie.ViewModels"
        x:Class="Theindie.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="The Indie Launcher" Icon="/Assets/Icons/Logo.ico"
        Background="Transparent" TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True" ExtendClientAreaChromeHints="NoChrome"
        Width="1280" Height="800" WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <DataTemplate x:Key="GameListTemplate" x:DataType="vm:MainWindowViewModel">
            <StackPanel Spacing="20">
                <TextBlock Text="DANH SÁCH GAME" FontWeight="Black" FontSize="14" Foreground="#666" LetterSpacing="1"/>
                <ItemsControl ItemsSource="{Binding Games}">
                    <ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel Margin="-8"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="models:GameInfo">
                            <components:GameCardView Width="220" Height="330" Click="OnGameCardClick"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </DataTemplate>
    </Window.Resources>

    <Panel PointerPressed="OnRootPointerPressed">
        <Border Background="#050505"/>
        <ExperimentalAcrylicBorder IsHitTestVisible="False">
            <ExperimentalAcrylicBorder.Material>
                <ExperimentalAcrylicMaterial BackgroundSource="Digger" TintColor="Black" TintOpacity="0.8" MaterialOpacity="0.5"/>
            </ExperimentalAcrylicBorder.Material>
        </ExperimentalAcrylicBorder>

        <Grid ColumnDefinitions="260, *">
            <Border Grid.Column="0" Background="#08FFFFFF" BorderBrush="{StaticResource GlassBorder}" BorderThickness="0,0,1,0" Padding="25">
                <Grid RowDefinitions="Auto, *, Auto">
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="15" Margin="0,15,0,50">
                        <Border Width="40" Height="40" Background="{StaticResource PrimaryRed}" CornerRadius="8" BoxShadow="0 0 20 0 #40FF1F2F">
                            <TextBlock Text="TI" Foreground="White" FontWeight="Black" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="THE INDIE" FontWeight="Black" FontSize="18" Foreground="White" LetterSpacing="0.5"/>
                            <TextBlock Text="LAUNCHER" FontSize="10" Foreground="#666" FontWeight="Bold" LetterSpacing="3"/>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Grid.Row="1" Spacing="8">
                        <TextBlock Text="MENU" FontSize="11" Foreground="#444" FontWeight="Bold" Margin="10,0,0,10" LetterSpacing="1"/>
                        
                        <Button Classes="SidebarItem" Command="{Binding SwitchPageCommand}" CommandParameter="0">
                            <StackPanel Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
                                <TextBlock Text="🏠" FontSize="16" VerticalAlignment="Center"/> <TextBlock Text="Trang Chủ" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Classes="SidebarItem" Command="{Binding SwitchPageCommand}" CommandParameter="1">
                            <StackPanel Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
                                <TextBlock Text="✅" FontSize="16" VerticalAlignment="Center"/> <TextBlock Text="Đã Cài Đặt" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <TextBlock Text="SYSTEM" FontSize="11" Foreground="#444" FontWeight="Bold" Margin="10,25,0,10" LetterSpacing="1"/>
                        <Button Classes="SidebarItem" Command="{Binding SwitchPageCommand}" CommandParameter="2">
                            <StackPanel Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
                                <TextBlock Text="⬇" FontSize="16" VerticalAlignment="Center"/> <TextBlock Text="Tải Xuống" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Classes="SidebarItem" Command="{Binding SwitchPageCommand}" CommandParameter="3">
                            <StackPanel Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
                                <TextBlock Text="⚙" FontSize="16" VerticalAlignment="Center"/> <TextBlock Text="Cấu Hình" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <Border Grid.Row="2" Background="#08FFFFFF" CornerRadius="12" Padding="12" BorderBrush="{StaticResource GlassBorder}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                            <Border Width="36" Height="36" CornerRadius="18" Background="#20FFFFFF" ClipToBounds="True">
                                <TextBlock Text="👤" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Game Thủ" FontWeight="Bold" Foreground="White" FontSize="13"/>
                                <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,2,0,0">
                                    <Border Width="6" Height="6" CornerRadius="3" Background="#4ade80" VerticalAlignment="Center"/>
                                    <TextBlock Text="Online" FontSize="11" Foreground="#4ade80"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <Grid Grid.Column="1" RowDefinitions="70, *">
                <Grid Grid.Row="0" Background="Transparent" PointerPressed="OnHeaderPointerPressed">
                    <Grid ColumnDefinitions="*, 250, 140" Margin="40,0">
                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                            <TextBlock Text="{Binding PageTitle}" FontWeight="Black" FontSize="24" Foreground="White" LetterSpacing="-0.5"/>
                        </StackPanel>
                        <TextBox Grid.Column="1" Text="{Binding SearchText}" Classes="SearchInput" Watermark="Tìm kiếm game..." VerticalAlignment="Center"/>
                    </Grid>
                </Grid>

                <Carousel Grid.Row="1" SelectedIndex="{Binding CurrentPage}">
                    <Carousel.PageTransition>
                        <PageSlide Orientation="Horizontal" Duration="0:0:0.4" SlideInEasing="CubicEaseOut" SlideOutEasing="CubicEaseOut"/>
                    </Carousel.PageTransition>
                    
                    <ScrollViewer Padding="40,0,40,40">
                        <StackPanel Spacing="35">
                            <Border Height="300" CornerRadius="16" ClipToBounds="True" BoxShadow="0 20 60 0 #60000000">
                                <Panel>
                                    <Image Source="/Assets/Icons/Logo.ico" Stretch="UniformToFill" Opacity="0.7">
                                        <Image.Effect><BlurEffect Radius="0"/></Image.Effect>
                                    </Image>
                                    <Border Background="{StaticResource BgDark}" Opacity="0.3"/>
                                    <Border><Border.Background><LinearGradientBrush StartPoint="0,0" EndPoint="0,1"><GradientStop Offset="0.4" Color="Transparent"/><GradientStop Offset="1" Color="#050505"/></LinearGradientBrush></Border.Background></Border>
                                    
                                    <StackPanel VerticalAlignment="Bottom" Margin="40">
                                        <Border Background="#30000000" CornerRadius="4" HorizontalAlignment="Left" Padding="8,4" Margin="0,0,0,10"><TextBlock Text="FEATURED UPDATE" Foreground="#FF1F2F" FontWeight="Black" FontSize="11" LetterSpacing="2"/></Border>
                                        <TextBlock Text="STARDEW VALLEY" FontWeight="Black" FontSize="48" Foreground="White" LineHeight="45"/>
                                        <TextBlock Text="Đã cập nhật bản Việt Hóa v1.5.6 đầy đủ DLC." Foreground="#CCC" FontSize="16" Margin="0,10,0,20"/>
                                        <Button Classes="Primary" Content="XEM NGAY" HorizontalAlignment="Left"/>
                                    </StackPanel>
                                </Panel>
                            </Border>
                            <ContentControl Content="{Binding}" ContentTemplate="{StaticResource GameListTemplate}"/>
                            <Panel Height="50"/>
                        </StackPanel>
                    </ScrollViewer>

                    <ScrollViewer Padding="40,0,40,40">
                        <StackPanel Spacing="30">
                            <ContentControl Content="{Binding}" ContentTemplate="{StaticResource GameListTemplate}"/>
                            <Panel Height="50"/>
                        </StackPanel>
                    </ScrollViewer>

                    <Grid><TextBlock Text="DOWNLOADS" FontSize="40" Foreground="#222" FontWeight="Black" HorizontalAlignment="Center" VerticalAlignment="Center"/></Grid>
                    <Grid><TextBlock Text="SETTINGS" FontSize="40" Foreground="#222" FontWeight="Black" HorizontalAlignment="Center" VerticalAlignment="Center"/></Grid>
                </Carousel>
            </Grid>
        </Grid>

        <components:GameDetailView Name="DetailOverlay" IsVisible="False" BackRequested="HideDetail_Overlay" InstallRequested="ShowInstall_Wizard" UninstallRequested="OnUninstallRequested"/>
        <components:InstallationWizardView Name="InstallWizard" IsVisible="False" CloseRequested="HideInstall_Wizard"/>

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0">
             <Button Classes="WindowControl" Content="─" Click="Minimize_Click"/>
             <Button Classes="WindowControl" Content="☐" Click="Maximize_Click"/>
             <Button Classes="WindowControl Close" Content="✕" Click="Close_Click"/>
        </StackPanel>
    </Panel>
</Window>